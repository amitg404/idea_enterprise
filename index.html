<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Timer with Mode Switch</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Roboto:wght@400;700&family=Montserrat:wght@400;600&display=swap" rel="stylesheet">
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Roboto', sans-serif;
            min-height: 100vh;
            background-color: #3a0605;
            color: #f5f5f5;
            overflow-x: hidden;
        }
        
        /* Timer styling */
        .timer-container {
            position: absolute;
            top: 420px;
            left: 0;
            width: 100%;
            text-align: center;
            z-index: 100;
        }
        
        .timer-wrapper {
            display: inline-block;
            position: relative;
        }
        
        #phase-indicator {
            position: absolute;
            top: -50px;
            left: 50%;
            transform: translateX(-50%);
            font-family: 'Montserrat', sans-serif;
            font-size: 24px;
            font-weight: 600;
            background-color: rgba(0, 0, 0, 0.6);
            padding: 5px 20px;
            border-radius: 10px;
            transition: all 0.5s ease;
        }
        
        #timer {
            font-size: 90px;
            font-weight: bold;
            font-family: 'Orbitron', sans-serif;
            transition: all 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55);
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
            position: relative;
        }
        
        .timer-pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); text-shadow: 0 0 20px rgba(255, 50, 50, 0.8); }
            100% { transform: scale(1); }
        }
        
        .timer-warning {
            animation: warning-flash 1s infinite;
        }
        
        @keyframes warning-flash {
            0% { color: white; }
            50% { color: #ff3b4a; }
            100% { color: white; }
        }
        
        .timer-critical {
            animation: critical-flash 0.5s infinite;
        }
        
        @keyframes critical-flash {
            0% { color: white; text-shadow: 0 0 10px rgba(255, 0, 0, 0.5); }
            50% { color: #ff0000; text-shadow: 0 0 20px rgba(255, 0, 0, 0.8); }
            100% { color: white; text-shadow: 0 0 10px rgba(255, 0, 0, 0.5); }
        }
        
        /* Controls Panel */
        .controls-panel {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 10px;
            display: flex;
            gap: 10px;
            z-index: 1000;
            transition: opacity 0.3s ease;
            opacity: 0.2;
        }
        
        .controls-panel:hover {
            opacity: 1;
        }
        
        .control-btn {
            background-color: #2c2c2c;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-family: 'Montserrat', sans-serif;
            transition: all 0.3s ease;
        }
        
        .control-btn:hover {
            background-color: #3a3a3a;
            transform: translateY(-2px);
        }
        
        .control-btn:active {
            transform: translateY(1px);
        }
        
        .edit-timer-panel {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(0, 0, 0, 0.85);
            border-radius: 10px;
            padding: 20px;
            z-index: 1001;
            display: none;
            flex-direction: column;
            gap: 15px;
            width: 300px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
        }
        
        .edit-timer-panel h2 {
            margin: 0 0 15px 0;
            color: white;
            font-family: 'Montserrat', sans-serif;
            text-align: center;
        }
        
        .input-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .input-group label {
            color: #dddddd;
            font-size: 14px;
        }
        
        .input-group input {
            padding: 8px;
            border-radius: 5px;
            border: 1px solid #444;
            background-color: #333;
            color: white;
        }
        
        .button-group {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
        }
        
        /* Mode indicator */
        .mode-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 10px 15px;
            border-radius: 5px;
            font-family: 'Montserrat', sans-serif;
            font-weight: 600;
            z-index: 100;
            transition: all 0.3s ease;
        }
        
        .normal-mode {
            background-color: rgba(30, 76, 139, 0.7);
        }
        
        .crisis-mode {
            background-color: rgba(183, 28, 28, 0.7);
        }
        
        /* Keypress indicators */
        .key-hint {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: rgba(0, 0, 0, 0.6);
            color: white;
            padding: 10px;
            border-radius: 5px;
            font-family: 'Roboto', sans-serif;
            font-size: 14px;
            z-index: 90;
            transition: opacity 0.3s ease;
            opacity: 0.5;
        }
        
        .key-hint:hover {
            opacity: 1;
        }
        
        .key {
            display: inline-block;
            padding: 2px 8px;
            margin: 0 2px;
            background-color: #555;
            border-radius: 3px;
            border: 1px solid #777;
            font-family: 'Courier New', monospace;
        }
        
        #motivational-quote {
            color: white;
            font-size: 20px;
            font-family: 'Roboto', sans-serif;
            font-weight: 400;
            line-height: 1.5;
            transition: opacity 0.5s ease;
            position: relative;
            top: 2px;
        }
        
        /* Make sure the content fills the page */
        #content {
            min-height: 100vh;
            position: relative;
        }
        
        /* Overlay animation */
        .mode-transition-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: black;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s ease;
        }
    </style>
    
    <script>
        // Initial time: 12 hours in seconds
        let totalSeconds = 12 * 60 * 60;
        let timerInterval;
        let timerStarted = false;
        let currentPhase = 1;
        let currentMode = "normal";

        // Function to save timer state to localStorage
        function saveTimerState() {
            localStorage.setItem('timerSeconds', totalSeconds);
            localStorage.setItem('timerStarted', timerStarted);
            localStorage.setItem('currentPhase', currentPhase);
            localStorage.setItem('currentMode', currentMode);
        }

        // Function to load timer state from localStorage
        function loadTimerState() {
            const savedSeconds = localStorage.getItem('timerSeconds');
            const savedStarted = localStorage.getItem('timerStarted');
            const savedPhase = localStorage.getItem('currentPhase');
            const savedMode = localStorage.getItem('currentMode');
            
            if (savedSeconds !== null) {
                totalSeconds = parseInt(savedSeconds);
            }
            
            if (savedPhase !== null) {
                currentPhase = parseInt(savedPhase);
                updatePhaseIndicator();
            }
            
            if (savedMode !== null) {
                currentMode = savedMode;
                updateModeIndicator();
            }
            
            if (savedStarted === 'true') {
                timerStarted = true;
                startTimer();
            }
            
            // Update display with saved time
            updateTimerDisplay();
        }

        // Update timer display
        function updateTimerDisplay() {
            let hours = String(Math.floor(totalSeconds / 3600)).padStart(2, '0');
            let minutes = String(Math.floor((totalSeconds % 3600) / 60)).padStart(2, '0');
            let seconds = String(totalSeconds % 60).padStart(2, '0');
            document.getElementById('timer').textContent = `${hours}:${minutes}:${seconds}`;
            
            // Add animations based on remaining time
            const timerElement = document.getElementById('timer');
            
            // Remove all animation classes first
            timerElement.classList.remove('timer-pulse', 'timer-warning', 'timer-critical');
            
            // Add appropriate animation class based on remaining time
            if (totalSeconds <= 300) { // Less than 5 minutes - critical
                timerElement.classList.add('timer-critical');
            } else if (totalSeconds <= 1800) { // Less than 30 minutes - warning
                timerElement.classList.add('timer-warning');
            } else if (timerStarted) { // Normal countdown - subtle pulse
                timerElement.classList.add('timer-pulse');
            }
        }

        // Start the timer
        function startTimer() {
            if (!timerInterval) {
                timerInterval = setInterval(updateTimer, 1000);
                timerStarted = true;
                document.getElementById('start-btn').textContent = 'Pause';
                saveTimerState();
            } else {
                clearInterval(timerInterval);
                timerInterval = null;
                timerStarted = false;
                document.getElementById('start-btn').textContent = 'Start';
                saveTimerState();
            }
        }

        // Reset the timer
        function resetTimer() {
            clearInterval(timerInterval);
            timerInterval = null;
            timerStarted = false;
            document.getElementById('start-btn').textContent = 'Start';
            totalSeconds = 12 * 60 * 60;
            updateTimerDisplay();
            saveTimerState();
        }

        function updateTimer() {
            if (totalSeconds > 0) {
                totalSeconds--;
                updateTimerDisplay();
                saveTimerState();
            } else {
                clearInterval(timerInterval);
                timerInterval = null;
                timerStarted = false;
                document.getElementById('start-btn').textContent = 'Start';
                
                // Alert when timer reaches zero
                showNotification("Timer complete!");
            }
        }

        function loadPage(page) {
            // Show transition overlay
            const overlay = document.querySelector('.mode-transition-overlay');
            overlay.style.opacity = '1';
            
            setTimeout(() => {
                fetch(page)
                    .then(response => response.text())
                    .then(html => {
                        document.getElementById("content").innerHTML = html;
                        document.getElementById("content").setAttribute("data-page", page);
                        
                        // Update current mode
                        currentMode = page === "normal.html" ? "normal" : "crisis";
                        updateModeIndicator();
                        saveTimerState();
                        
                        // Hide overlay after content is loaded
                        setTimeout(() => {
                            overlay.style.opacity = '0';
                        }, 300);
                    })
                    .catch(error => {
                        console.error("Error loading page:", error);
                        overlay.style.opacity = '0';
                    });
            }, 300);
        }
        
        // Update timer color based on mode
        function updateTimerColor() {
            const timerElement = document.getElementById('timer');
            const phaseElement = document.getElementById('phase-indicator');
            
            if (currentMode === "normal") {
                timerElement.style.color = '#000000';
                phaseElement.style.color = '#ffffff';
                phaseElement.style.backgroundColor = 'rgba(30, 76, 139, 0.7)';
            } else {
                timerElement.style.color = '#ffffff';
                phaseElement.style.color = '#ffffff';
                phaseElement.style.backgroundColor = 'rgba(183, 28, 28, 0.7)';
            }
        }
        
        // Update phase indicator
        function updatePhaseIndicator() {
            document.getElementById('phase-indicator').textContent = `PHASE ${currentPhase}`;
        }
        
        // Update mode indicator
        function updateModeIndicator() {
            const modeIndicator = document.querySelector('.mode-indicator');
            
            if (currentMode === "normal") {
                modeIndicator.textContent = "NORMAL MODE";
                modeIndicator.classList.remove('crisis-mode');
                modeIndicator.classList.add('normal-mode');
            } else {
                modeIndicator.textContent = "CRISIS MODE";
                modeIndicator.classList.remove('normal-mode');
                modeIndicator.classList.add('crisis-mode');
            }
            
            updateTimerColor();
        }
        
        // Show/hide timer edit panel
        function toggleEditPanel() {
            const panel = document.querySelector('.edit-timer-panel');
            
            if (panel.style.display === 'flex') {
                panel.style.display = 'none';
            } else {
                // Set current values in form
                document.getElementById('hours-input').value = Math.floor(totalSeconds / 3600);
                document.getElementById('minutes-input').value = Math.floor((totalSeconds % 3600) / 60);
                document.getElementById('seconds-input').value = totalSeconds % 60;
                document.getElementById('phase-input').value = currentPhase;
                
                panel.style.display = 'flex';
            }
        }
        
        // Save timer settings
        function saveTimerSettings() {
            const hours = parseInt(document.getElementById('hours-input').value) || 0;
            const minutes = parseInt(document.getElementById('minutes-input').value) || 0;
            const seconds = parseInt(document.getElementById('seconds-input').value) || 0;
            const phase = parseInt(document.getElementById('phase-input').value) || 1;
            
            totalSeconds = (hours * 3600) + (minutes * 60) + seconds;
            currentPhase = phase;
            
            updateTimerDisplay();
            updatePhaseIndicator();
            saveTimerState();
            
            toggleEditPanel();
            
            // Show notification
            showNotification("Timer settings updated");
        }
        
        // Show notification
        function showNotification(message) {
            // Check if notification element exists, if not create it
            let notification = document.getElementById('notification');
            
            if (!notification) {
                notification = document.createElement('div');
                notification.id = 'notification';
                notification.style.position = 'fixed';
                notification.style.top = '20px';
                notification.style.left = '50%';
                notification.style.transform = 'translateX(-50%)';
                notification.style.backgroundColor = 'rgba(0, 0, 0, 0.8)';
                notification.style.color = 'white';
                notification.style.padding = '10px 20px';
                notification.style.borderRadius = '5px';
                notification.style.fontFamily = 'Montserrat, sans-serif';
                notification.style.zIndex = '2000';
                notification.style.opacity = '0';
                notification.style.transition = 'opacity 0.3s ease';
                
                document.body.appendChild(notification);
            }
            
            // Set message and show notification
            notification.textContent = message;
            notification.style.opacity = '1';
            
            // Hide after 3 seconds
            setTimeout(() => {
                notification.style.opacity = '0';
            }, 3000);
        }
        
        // Increment phase
        function incrementPhase() {
            currentPhase++;
            updatePhaseIndicator();
            saveTimerState();
            showNotification(`Advanced to Phase ${currentPhase}`);
            
            // Add a visual effect when changing phase
            const phaseElement = document.getElementById('phase-indicator');
            phaseElement.style.transform = 'translateX(-50%) scale(1.2)';
            setTimeout(() => {
                phaseElement.style.transform = 'translateX(-50%) scale(1)';
            }, 300);
        }
        
        // Decrement phase
        function decrementPhase() {
            if (currentPhase > 1) {
                currentPhase--;
                updatePhaseIndicator();
                saveTimerState();
                showNotification(`Returned to Phase ${currentPhase}`);
                
                // Add a visual effect when changing phase
                const phaseElement = document.getElementById('phase-indicator');
                phaseElement.style.transform = 'translateX(-50%) scale(0.8)';
                setTimeout(() => {
                    phaseElement.style.transform = 'translateX(-50%) scale(1)';
                }, 300);
            }
        }

        document.addEventListener("DOMContentLoaded", function () {
            // Create overlay for transitions
            const overlay = document.createElement('div');
            overlay.className = 'mode-transition-overlay';
            document.body.appendChild(overlay);
            
            // Create timer wrapper and phase indicator
            const timerContainer = document.querySelector('.timer-container');
            const timerWrapper = document.createElement('div');
            timerWrapper.className = 'timer-wrapper';
            
            const phaseIndicator = document.createElement('div');
            phaseIndicator.id = 'phase-indicator';
            phaseIndicator.textContent = 'PHASE 1';
            
            timerWrapper.appendChild(phaseIndicator);
            timerWrapper.appendChild(document.getElementById('timer'));
            timerContainer.appendChild(timerWrapper);
            
            // Create mode indicator
            const modeIndicator = document.createElement('div');
            modeIndicator.className = 'mode-indicator normal-mode';
            modeIndicator.textContent = 'NORMAL MODE';
            document.body.appendChild(modeIndicator);
            
            // Create controls panel
            const controlsPanel = document.createElement('div');
            controlsPanel.className = 'controls-panel';
            
            const startBtn = document.createElement('button');
            startBtn.id = 'start-btn';
            startBtn.className = 'control-btn';
            startBtn.textContent = 'Start';
            startBtn.onclick = startTimer;
            
            const resetBtn = document.createElement('button');
            resetBtn.className = 'control-btn';
            resetBtn.textContent = 'Reset';
            resetBtn.onclick = resetTimer;
            
            const editBtn = document.createElement('button');
            editBtn.className = 'control-btn';
            editBtn.textContent = 'Edit Timer';
            editBtn.onclick = toggleEditPanel;
            
            const modeBtn = document.createElement('button');
            modeBtn.className = 'control-btn';
            modeBtn.textContent = 'Toggle Mode';
            modeBtn.onclick = function() {
                let currentPage = document.getElementById("content").getAttribute("data-page");
                let newPage = currentPage === "normal.html" ? "crisis.html" : "normal.html";
                loadPage(newPage);
            };
            
            const phaseUpBtn = document.createElement('button');
            phaseUpBtn.className = 'control-btn';
            phaseUpBtn.textContent = 'Phase +';
            phaseUpBtn.onclick = incrementPhase;
            
            const phaseDownBtn = document.createElement('button');
            phaseDownBtn.className = 'control-btn';
            phaseDownBtn.textContent = 'Phase -';
            phaseDownBtn.onclick = decrementPhase;
            
            controlsPanel.appendChild(startBtn);
            controlsPanel.appendChild(resetBtn);
            controlsPanel.appendChild(editBtn);
            controlsPanel.appendChild(modeBtn);
            controlsPanel.appendChild(phaseUpBtn);
            controlsPanel.appendChild(phaseDownBtn);
            
            document.body.appendChild(controlsPanel);
            
            // Create edit timer panel
            const editPanel = document.createElement('div');
            editPanel.className = 'edit-timer-panel';
            editPanel.innerHTML = `
                <h2>Edit Timer</h2>
                <div class="input-group">
                    <label for="hours-input">Hours:</label>
                    <input type="number" id="hours-input" min="0" max="99">
                </div>
                <div class="input-group">
                    <label for="minutes-input">Minutes:</label>
                    <input type="number" id="minutes-input" min="0" max="59">
                </div>
                <div class="input-group">
                    <label for="seconds-input">Seconds:</label>
                    <input type="number" id="seconds-input" min="0" max="59">
                </div>
                <div class="input-group">
                    <label for="phase-input">Phase Number:</label>
                    <input type="number" id="phase-input" min="1" max="99">
                </div>
                <div class="button-group">
                    <button id="cancel-btn" class="control-btn">Cancel</button>
                    <button id="save-btn" class="control-btn">Save</button>
                </div>
            `;
            
            document.body.appendChild(editPanel);
            
            // Set up the edit panel buttons
            document.getElementById('save-btn').addEventListener('click', saveTimerSettings);
            document.getElementById('cancel-btn').addEventListener('click', toggleEditPanel);
            
            // Create key hint information
            const keyHint = document.createElement('div');
            keyHint.className = 'key-hint';
            keyHint.innerHTML = `
                Keyboard Shortcuts:<br>
                <span class="key">T</span> Toggle Mode<br>
                <span class="key">P</span> Start/Pause Timer<br>
                <span class="key">Y</span> Reset Timer<br>
                <span class="key">+</span> Increase Phase<br>
                <span class="key">-</span> Decrease Phase
            `;
            
            document.body.appendChild(keyHint);
            
            // Load default normal mode
            loadPage("normal.html");
            
            // Load timer state from localStorage
            loadTimerState();
        });

        // Keydown event listeners
        document.addEventListener("keydown", function (event) {
            // Toggle mode with T key
            if (event.key === "T" || event.key === "t") {
                let currentPage = document.getElementById("content").getAttribute("data-page");
                let newPage = currentPage === "normal.html" ? "crisis.html" : "normal.html";
                loadPage(newPage);
            }
            
            // Start/pause timer with P key
            if (event.key === "P" || event.key === "p") {
                startTimer();
            }
            
            // Reset timer with Y key
            if (event.key === "Y" || event.key === "y") {
                resetTimer();
            }
            
            // Increment phase with + key
            if (event.key === "+" || event.key === "=") {
                incrementPhase();
            }
            
            // Decrement phase with - key
            if (event.key === "-" || event.key === "_") {
                decrementPhase();
            }
            
            // Toggle edit panel with E key
            if (event.key === "E" || event.key === "e") {
                toggleEditPanel();
            }
        });
        
        // Motivational Quotes Code
        const quotes = [
          "Success is not final, failure is not fatal: It is the courage to continue that counts.",
          "The future belongs to those who believe in the beauty of their dreams.",
          "Believe you can and you're halfway there.",
          "The only way to do great work is to love what you do.",
          "Don't watch the clock; do what it does. Keep going.",
          "The best way to predict the future is to create it."
        ];

        let currentQuoteIndex = 0;

        function rotateQuotes() {
          const quoteElement = document.getElementById('motivational-quote');
          if (quoteElement) {
              quoteElement.textContent = quotes[currentQuoteIndex];
              
              // Fade in animation
              quoteElement.style.opacity = 0;
              setTimeout(() => {
                quoteElement.style.opacity = 1;
              }, 200);
              
              // Move to next quote
              currentQuoteIndex = (currentQuoteIndex + 1) % quotes.length;
          }
        }

        // Save timer state before page unloads
        window.addEventListener("beforeunload", function() {
            saveTimerState();
        });
    </script>
</head>
<body>
    <div class="timer-container">
        <div id="timer">12:00:00</div>
    </div>
    <div id="content" data-page="normal.html"></div>
</body>
</html>
